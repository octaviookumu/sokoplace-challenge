(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{71:function(e,t,n){},82:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n.n(r),a=n(54),i=n.n(a),o=(n(71),n(8)),s=n(21),l=n(7),j=n(13),d=n.n(j),u=n(24),b=n(12),p=n(96),h=n(60),O=n(85),v=n(93),f=n(94),g=n(90),x=n(62),m=n(61),k=n(55),w=n(3),S="",y={appState:{loggedIn:!1},gqlError:{msg:""},appSetLogin:function(e){},appSetLogout:function(){},appSetAuthToken:function(e){},appClearAuthToken:function(){}},C=Object(r.createContext)(y);var E,L,I,_,T=function(e){var t=e.children,n=Object(r.useState)({loggedIn:!1}),c=Object(o.a)(n,2),a=c[0],i=c[1],s=Object(r.useState)({msg:""}),l=Object(o.a)(s,2),j=l[0],d=l[1],u=function(){S="",i(Object(b.a)(Object(b.a)({},a),{},{loggedIn:!1}))},y=function(e){S=e},E=function(){return S},L=new p.a({}),I=new h.a((function(e,t){return new O.a((function(n){var r;return Promise.resolve(e).then((function(e){e.setContext({headers:{authorization:"Bearer ".concat(E())}})})).then((function(){r=t(e).subscribe({next:n.next.bind(n),error:n.error.bind(n),complete:n.complete.bind(n)})})).catch(n.error.bind(n)),function(){r&&r.unsubscribe()}}))})),_=new v.a({link:h.a.from([new m.a({accessTokenField:"access_token",isTokenValidOrUndefined:function(){var e=E();if(0===e.length)return!0;try{var t=Object(k.a)(e).exp;return Date.now()<1e3*t}catch(n){return!1}},fetchAccessToken:$,handleFetch:function(e){console.log("handleFetch: ".concat(e)),y(e)},handleResponse:function(e,t){console.log("handleResponse: ".concat(t)),console.log(e)},handleError:function(e){console.log("handleError: ".concat(e)),u()}}),Object(x.a)((function(e){var t=e.graphQLErrors;e.networkError;if(void 0!==t&&void 0!==t[0].path&&"refresh"!==t[0].path[0]){var n=t[0].message;d({msg:n})}})),I,new f.a({uri:"/graphql",credentials:"include"})]),cache:L});return Object(w.jsx)(C.Provider,{value:{appState:a,gqlError:j,appSetLogin:function(e){S=e,i(Object(b.a)(Object(b.a)({},a),{},{loggedIn:!0}))},appSetLogout:u,appSetAuthToken:y,appClearAuthToken:function(){S=""}},children:Object(w.jsx)(g.a,{client:_,children:t})})},$=function(){var e=Object(u.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={operationName:"Refresh",variables:{},query:"mutation Refresh {\n refresh {\n access_token\n __typename\n}\n}\n"},e.abrupt("return",fetch("https://graphql-user-api.herokuapp.com/graphql",{method:"POST",credentials:"include",body:JSON.stringify(t),headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"}}).then(function(){var e=Object(u.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return n=e.sent,console.log("fetchAccessToken"),console.log(n.data.refresh),e.abrupt("return",n.data.refresh);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){return Object(r.useContext)(C).appState.loggedIn?Object(w.jsx)("div",{children:"Logged in user landing page"}):Object(w.jsx)("div",{children:"Regular landing page"})},q=n(36),A=n(95),R=n(98),D=n(91),N=(n(92),{}),F=Object(A.a)(E||(E=Object(q.a)(["\n    mutation Register($email: String!, $password: String!, $confirmation: String!) {\n  register(email: $email, password: $password, confirmation: $confirmation) {\n    ukey\n    tmp_confirm_token\n  }\n}\n    "])));var J=Object(A.a)(L||(L=Object(q.a)(["\n    mutation Confirm($email: String!) {\n  confirm(email: $email)\n}\n    "])));var z=Object(A.a)(I||(I=Object(q.a)(["\n    mutation Login($email: String!, $password: String!) {\n  login(email: $email, password: $password) {\n    ukey\n    access_token\n  }\n}\n    "])));var B=Object(A.a)(_||(_=Object(q.a)(["\n    query Profile {\n  profile {\n    email\n  }\n}\n    "])));var H=function(){var e=Object(l.g)(),t=Object(r.useContext)(C),n=t.appSetLogin,c=t.gqlError,a=function(e){var t=Object(b.a)(Object(b.a)({},N),e);return R.a(z,t)}(),i=Object(o.a)(a,1)[0],s=Object(r.useState)(""),j=Object(o.a)(s,2),p=j[0],h=j[1],O=Object(r.useState)(""),v=Object(o.a)(O,2),f=v[0],g=v[1],x=Object(r.useState)(!1),m=Object(o.a)(x,2),k=m[0],S=m[1];return Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{children:"Login page"}),k?Object(w.jsx)("div",{children:c.msg}):void 0,Object(w.jsxs)("form",{onSubmit:function(){var t=Object(u.a)(d.a.mark((function t(r){var c,a,o,s;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.preventDefault(),t.prev=1,S(!1),t.next=5,i({variables:{email:p,password:f}});case 5:if(o=t.sent,void 0!==(s=o.data)&&void 0!==(null===s||void 0===s?void 0:s.login)&&void 0!==(null===(c=s.login)||void 0===c?void 0:c.access_token)){t.next=9;break}throw new Error("Invalid credentials");case 9:n(null===(a=s.login)||void 0===a?void 0:a.access_token),e.replace("/"),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),S(!0);case 16:case"end":return t.stop()}}),t,null,[[1,13]])})));return function(e){return t.apply(this,arguments)}}(),children:[Object(w.jsx)("div",{children:Object(w.jsx)("input",{value:p,placeholder:"Email",onChange:function(e){h(e.target.value)}})}),Object(w.jsx)("div",{children:Object(w.jsx)("input",{value:f,placeholder:"Password",type:"password",onChange:function(e){g(e.target.value)}})}),Object(w.jsx)("button",{type:"submit",children:"Login"})]})]})},M=function(){var e=Object(l.g)(),t=Object(r.useContext)(C).gqlError,n=function(e){var t=Object(b.a)(Object(b.a)({},N),e);return R.a(F,t)}(),c=Object(o.a)(n,1)[0],a=Object(r.useState)(""),i=Object(o.a)(a,2),s=i[0],j=i[1],p=Object(r.useState)(""),h=Object(o.a)(p,2),O=h[0],v=h[1],f=Object(r.useState)(""),g=Object(o.a)(f,2),x=g[0],m=g[1],k=Object(r.useState)(!1),S=Object(o.a)(k,2),y=S[0],E=S[1];return Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{children:"Register page"}),y?Object(w.jsx)("div",{children:t.msg}):void 0,Object(w.jsxs)("form",{onSubmit:function(){var t=Object(u.a)(d.a.mark((function t(n){var r,a,i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,E(!1),t.next=5,c({variables:{email:s,password:O,confirmation:x}});case 5:if(a=t.sent,void 0!==(i=a.data)&&void 0!==(null===i||void 0===i?void 0:i.register)){t.next=9;break}throw new Error("Invalid credentials");case 9:e.replace("/confirm/".concat(null===i||void 0===i||null===(r=i.register)||void 0===r?void 0:r.tmp_confirm_token)),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),E(!0);case 15:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(e){return t.apply(this,arguments)}}(),children:[Object(w.jsx)("div",{children:Object(w.jsx)("input",{value:s,placeholder:"Email",onChange:function(e){j(e.target.value)}})}),Object(w.jsx)("div",{children:Object(w.jsx)("input",{value:O,placeholder:"Password",type:"password",onChange:function(e){v(e.target.value)}})}),Object(w.jsx)("div",{children:Object(w.jsx)("input",{value:x,placeholder:"Confirm Password",type:"password",onChange:function(e){m(e.target.value)}})}),Object(w.jsx)("button",{type:"submit",children:"Register"})]})]})},Q=function(){var e,t=Object(l.g)(),n=function(e){var t=Object(b.a)(Object(b.a)({},N),e);return D.a(B,t)}({fetchPolicy:"network-only"}),r=n.data,c=n.loading,a=n.error;return c?Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{children:"Profile page"}),Object(w.jsx)("div",{children:"Loading.."})]}):(a&&t.replace("/"),Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{children:"Profile page"}),Object(w.jsxs)("div",{children:["Email: ",null===r||void 0===r||null===(e=r.profile)||void 0===e?void 0:e.email]})]}))},U=function(){return Object(w.jsx)("div",{children:"Not found"})},V=function(){var e=Object(l.g)(),t=Object(r.useContext)(C),n=t.appSetAuthToken,c=t.appClearAuthToken,a=t.gqlError,i=Object(r.useState)(!1),s=Object(o.a)(i,2),j=s[0],p=s[1],h=Object(r.useState)(""),O=Object(o.a)(h,2),v=O[0],f=O[1],g=function(e){var t=Object(b.a)(Object(b.a)({},N),e);return R.a(J,t)}(),x=Object(o.a)(g,1)[0],m=Object(l.h)().token;return void 0===m||""===m?Object(w.jsx)("div",{children:"Invalid user confirmation link"}):Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{children:"Confirmation page"}),j?Object(w.jsx)("div",{children:a.msg}):void 0,Object(w.jsxs)("form",{onSubmit:function(){var t=Object(u.a)(d.a.mark((function t(r){var a,i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.preventDefault(),t.prev=1,p(!1),n(m),t.next=6,x({variables:{email:v}});case 6:if(a=t.sent,i=a.data,c(),void 0!==i&&void 0!==(null===i||void 0===i?void 0:i.confirm)&&i.confirm){t.next=11;break}throw new Error("Not authorized");case 11:e.replace("/login"),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),p(!0);case 17:case"end":return t.stop()}}),t,null,[[1,14]])})));return function(e){return t.apply(this,arguments)}}(),children:[Object(w.jsx)("div",{children:Object(w.jsx)("input",{value:v,placeholder:"Email",onChange:function(e){f(e.target.value)}})}),Object(w.jsx)("button",{type:"submit",children:"Confirm"})]})]})},G=!1,K=function(){var e=Object(r.useState)(!0),t=Object(o.a)(e,2),n=t[0],c=t[1],a=Object(r.useContext)(C),i=a.appState,j=a.appSetLogin,d=a.appSetLogout;return Object(r.useEffect)((function(){G||(G=!0,$().then((function(e){void 0===e||void 0===(null===e||void 0===e?void 0:e.access_token)?d():j(null===e||void 0===e?void 0:e.access_token)})).catch((function(e){d()})).finally((function(){c(!1)})))})),n?Object(w.jsx)("div",{children:"Loading.."}):Object(w.jsx)(s.a,{children:Object(w.jsxs)("div",{children:[Object(w.jsx)("header",{children:i.loggedIn?Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{children:Object(w.jsx)(s.b,{to:"/",children:"Home"})}),Object(w.jsx)("div",{children:Object(w.jsx)(s.b,{to:"/profile",children:"Profile"})})]}):Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{children:Object(w.jsx)(s.b,{to:"/",children:"Home"})}),Object(w.jsx)("div",{children:Object(w.jsx)(s.b,{to:"/register",children:"Register"})}),Object(w.jsx)("div",{children:Object(w.jsx)(s.b,{to:"/login",children:"Login"})})]})}),Object(w.jsxs)(l.d,{children:[Object(w.jsx)(l.b,{exact:!0,path:"/",component:P}),Object(w.jsx)(l.b,{exact:!0,path:"/register",children:i.loggedIn?Object(w.jsx)(l.a,{to:"/"}):Object(w.jsx)(M,{})}),Object(w.jsx)(l.b,{exact:!0,path:"/confirm/:token",children:i.loggedIn?Object(w.jsx)(l.a,{to:"/"}):Object(w.jsx)(V,{})}),Object(w.jsx)(l.b,{exact:!0,path:"/login",children:i.loggedIn?Object(w.jsx)(l.a,{to:"/"}):Object(w.jsx)(H,{})}),Object(w.jsx)(l.b,{exact:!0,path:"/profile",children:i.loggedIn?Object(w.jsx)(Q,{}):Object(w.jsx)(l.a,{to:"/login"})}),Object(w.jsx)(l.b,{component:U})]})]})})};i.a.render(Object(w.jsx)(c.a.StrictMode,{children:Object(w.jsx)(T,{children:Object(w.jsx)(K,{})})}),document.getElementById("root"))}},[[82,1,2]]]);
//# sourceMappingURL=main.deafa5dc.chunk.js.map